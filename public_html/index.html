<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        
        <title>Redact-O-Matic</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-fileupload.min.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-arrows.css">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="stylesheet" type="text/css" href="css/skin.css">        

        <script type="text/javascript" src="js/libs/zip.js"></script>
        <script type="text/javascript" src="js/libs/zip-ext.js"></script>
        <script type="text/javascript" src="js/libs/exif.js"></script>
        <script type="text/javascript" src="js/libs/binaryajax.js"></script>

        <script type="text/javascript" src="js/libs/jquery-1.9.0/jquery.min.js"></script>
        <script type="text/javascript" src="js/libs/jqueryui-1.10.0/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/libs/jquery.exif.js"></script>

        <script type="text/javascript" src="js/libs/bootstrap.js"></script>
        <script type="text/javascript" src="js/libs/bootstrap-fileupload.min.js"></script>
        <script type="text/javascript" src="js/libs/bootstrap-arrows.js"></script>

        <script type="text/javascript" src="js/libs/jquery.jcarousel.js"></script>
        <script type="text/javascript" src="js/libs/jquery.jcarousel.min.js"></script>

        <script type="text/javascript" src="js/PowerPointReader.js"></script>
        <script type="text/javascript" src="js/PowerPointImage.js"></script>
        <script type="text/javascript" src="js/PowerPoint.js"></script>
        <script type="text/javascript" src="js/SlideImageRel.js"></script>

        <script type="text/javascript" src="js/PowerPointViewer.js"></script>

        <script type="text/javascript" src="js/Change.js"></script>
        <script type="text/javascript" src="js/PowerPointWriter.js"></script>

        <script type="text/javascript" src="js/PowerPointRedactor.js"></script>

        <script type="text/javascript" src="js/FlickrReader.js"></script>
        <script type="text/javascript" src="js/FlickrImage.js"></script>
        <script type="text/javascript" src="js/FlickrResultsViewer.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    </head>
    <body>

        <div id="title">
            <img src="img/title.png"/>
        </div>
        <script type="text/javascript">
            //check for the various File API support
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                //all file APIs are supported
            } else {
                alert('The File APIs are not fully supported in this browser.');
            }
        </script>

        <div class="container-fluid">
            <div id="controlPanel" class="row-fluid">
                <div class="fileupload fileupload-new" data-provides="fileupload">
                    <span class="btn btn-file"><span class="fileupload-new">Select file</span><span class="fileupload-exists">Change</span><input id="files" type="file" /></span>
                    <span class="fileupload-preview"></span>
                    <a href="#" class="close fileupload-exists" data-dismiss="fileupload" style="float: none">×</a>
                </div>

                <button id="redactBtn" type="submit" class="btn disabled">Redact...</button>
                <span id="download">
                    <img id="downloadLoading" src="img/ajax-loader-small.gif"/>
                    <!--<a id="download" href="#"></a>-->
                </span>
                <!--<input type="file" id="files" name="files[]" multiple/>
                <output id="list"></output>-->
            </div>
            <!--<div id="imageList" class="row-fluid">
            </div>-->
            
            <div id="test"></div>

            <div id="imageOverview" class="row-fluid">
                
                <div id="imageWindow" class="span9">
                
                    <span id="instructions" class="hasFocus">
                        <img src="img/instructions.png"/>
                    </span>
                    
                    <span id="pptImage">
                        <span class="helper"></span>
                    </span>   
                    
                    <!-- Overview -->
                    <div id="overview">
                        <h2>Overview</h2>
                        <div class="overviewField">
                            <h4>
                                Name:
                            </h4>
                            <div id="pptName">                            
                            </div>
                        </div>
                        <div class="overviewField">
                            <h4>
                                Total Images:
                            </h4>
                            <div id="totalImages">
                            </div>

                        </div>
                        <div class="overviewField">
                            <h4>
                                Licenced Images:
                            </h4>
                            <div id="licencedImages">
                            </div>

                        </div>
                        <div class="overviewField">
                            <h4>
                                Most restrictive licence:
                            </h4>
                            <div id="overallLicence">
                            </div>

                        </div>
                        <div class="overviewField">
                            <h4>
                                Progress:
                            </h4>
                            <div class="progress progress-striped"> <!-- consider implementing stacked bar to show types of licence -->
                                <div id="progressCC" class="bar bar-success"></div>
                                <div id="progressOther" class="bar bar-warning"></div>
                                <div id="progressNull" class="bar bar-danger"></div>
                            </div> 
                        </div>                   
                    </div>
                    
                    <!-- placeholder -->
                    <span id="placeholderOverview">                        
                        <span class="helper"></span>
                        <span id="placeholderOld">
                        </span>
                        <span id="placeholderArrow">
                            <span class="arrow-primary-large" data-angle="90"></span>
                        </span>
                        <span id="placeholderNew">
                            <img class="placeholderImage" src="img/placeholder.jpg"/>
                        </span>  
                        <button id="placeholderSave" class="btn btn-primary">Save</button>
                        <button id="placeholderUndo" class="btn btn-danger">Undo</button>
                    </span>

                    <!-- Flickr Search -->
                    <div id="flickrSearch"> 
                        <!-- Flickr Search Form -->
                        <form id="flickr" class="form-inline">
                            <input type="text" class="input-medium search-query flickrForm" placeholder="Search" name="tags" id="tags">

                            <label class="multiple flickrForm" for="sort">Sort:</label>
                            <select id="sort" name="sort" class="input-medium">
                                <option>Relevant</option>
                                <option>Recent</option>
                                <option>Interesting</option>
                            </select>
                            <label class="multiple flickrForm" for="licence">Licence:</label>
                            <select id="flickrLicence" name="licence" class="input-medium">
                                <option>Attribution (CC BY)</option>
                                <option>ShareAlike (CC BY-SA)</option>
                                <option>NoDerivs (CC BY-ND)</option>
                                <option>NonCommercial (CC BY-NC)</option>
                                <option>NonCommercial, ShareAlike (CC BY-NC-SA)</option>
                                <option>NonCommercial, NoDerivs (CC BY-NC-ND)</option>
                            </select>
                            <button type="submit" class="btn flickrForm">Search</button>
                        </form>
                        
                        <!-- Flickr Results -->
                        <div id="flickr-loading">
                            <span class="flickrHelper"></span>
                            <img src="img/ajax-loader.gif"/>
                        </div>
                        <div id="flickr-results" class="row">
                            <div id="flickrPrev" class="span1 disabled"></div>
                            <div id="resultImages" class="span10">
                                <div class="row flickr-row">
                                    <div id="flickr0" class="span2 offset1">
                                    </div>
                                    <div id="flickr1" class="span2">
                                    </div>
                                    <div id="flickr2" class="span2">
                                    </div>
                                    <div id="flickr3" class="span2">
                                    </div>
                                    <div id="flickr4" class="span2">
                                    </div>
                                </div>
                                <div class="row flickr-row">
                                    <div id="flickr5" class="span2 offset1">
                                    </div>
                                    <div id="flickr6" class="span2">
                                    </div>
                                    <div id="flickr7" class="span2">
                                    </div>
                                    <div id="flickr8" class="span2">
                                    </div>
                                    <div id="flickr9" class="span2">
                                    </div>
                                </div>
                                <div class="row flickr-row">
                                    <div id="flickr10" class="span2 offset1">
                                    </div>
                                    <div id="flickr11" class="span2">
                                    </div>
                                    <div id="flickr12" class="span2">
                                    </div>
                                    <div id="flickr13" class="span2">
                                    </div>
                                    <div id="flickr14" class="span2">
                                    </div>
                                </div>
                            </div>
                            <div id="flickrNext" class="span1 disabled"></div>
                        </div>
                    </div>  

                    <!-- Flickr Overview -->
                    <span id="flickrOverview">
                        <span class="helper"></span>
                        <span id="flickrOverviewImages">
                            <span class="helper"></span>
                            <span id="flickrOld">
                            </span>
                            <span id="flickrArrow">
                                <span class="arrow-primary-large" data-angle="90"></span>
                            </span>
                            <span id="flickrNew">
                            </span> 
                        </span>
                        <span id="flickrOverviewButtons">
                            <button id="flickrBack" class="btn btn-primary">Back</button>                    
                            <button id="flickrSave" class="btn btn-primary">Save</button>
                            <button id="flickrUndo" class="btn btn-danger">Undo</button>
                        </span>
                    </span>

                    <!-- cc Overview -->
                    <div id="ccOverview" class="row-fluid">
                        <div id="ccOld" class="span6">
                        </div>                        
                        <div id="ccText" class="span6">                            
                            <h2>Choose a CC Licence:</h2>
                            <p>For more information see: <a href="http://creativecommons.org/" target="_blank">Creative Commons</a></p>
                            <select id="ccSelector">
                                <option>CC0</option>
                                <option>Attribution (CC BY)</option>
                                <option>ShareAlike (CC BY-SA)</option>
                                <option>NoDerivs (CC BY-ND)</option>
                                <option>NonCommercial (CC BY-NC)</option>
                                <option>NonCommercial, ShareAlike (CC BY-NC-SA)</option>
                                <option>NonCommercial, NoDerivs (CC BY-NC-ND)</option>                                
                            </select>
                        </div>  
                        <span class="overviewButtons">
                            <button id="ccSave" class="btn btn-primary">Save</button>
                            <button id="ccUndo" class="btn btn-danger">Undo</button>
                        </span>
                    </div>

                </div>

                <!-- Image Info/Buttons Panel -->
                <div id="imagePanel" class="span3">
                    <div id="imageInfo">
                        <span class="imageField">
                            <span>
                                Slides:
                            </span>  
                            <span id="imageSlides">

                            </span>
                        </span>
                        <span class="imageField">
                            <span>
                                Author:
                            </span>
                            <span id="imageAuthor">
                            </span>
                        </span>
                        <span class="imageField">
                            <span>
                                Licence:
                            </span>
                            <span id="imageLicence">
                            </span>
                        </span>
                        <span class="imageField">
                            <span>
                                Size:
                            </span>
                            <span id="imageSize">
                            </span>
                        </span>
                    </div>
                    <div id="buttons">
                        <button id="overviewBtn" class="btn btn-primary btn-block imageButtons disabled">Overview</button>                        
                        <button id="flickrBtn" class="btn btn-success btn-block imageButtons disabled">Flickr</button>
                        <button id="ccBtn" class="btn btn-warning btn-block imageButtons disabled">Creative Commons</button>
                        <button id="placeholderBtn" class="btn btn-danger btn-block imageButtons disabled">Placeholder</button>
                    </div>
                </div>                
            </div>
            <div class="row-fluid">
                <div id="imageCarousel" class="span12">
                    <ul id="mycarousel" class="jcarousel-skin-tango">
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="copyright">
            © University of Southampton
        </div>

        <script>
            //file loading functionality
            var powerpointRedactor = new PowerPointRedactor();
            $('#redactBtn').data("redactor", powerpointRedactor);

            function handleFileSelect(evt) {

                var files = evt.target.files; // FileList object

                for (var i = 0, f; f = files[i]; i++) {
                    //create a PowerPointReader for the file
                    var pptReader = new PowerPointReader(f);
                    powerpoint = pptReader.readPowerPoint();
                }
            }

            document.getElementById('files').addEventListener('change', handleFileSelect, false);

            //perform flickr search
            $('#flickr').submit(function() {
                //unbind any previous functions associated with the next and previous buttons for flickr
                $("#flickrPrev").unbind('click');
                $("#flickrNext").unbind('click');
                
                if ($('#tags').val() == "") {
                    //prompt user for search terms
                    $('#searchControl').addClass("error");
                } else {
                    $('#searchControl').removeClass("error");
                    //do a search
                    var tags = $('#tags').val();
                    var sort = $('#sort').val();
                    var licence = $('#flickrLicence').val();
                    var flickrReader = new FlickrReader(tags, sort, licence);
                    flickrReader.buildQuery();
                }
                return false;
            });

            //redact button
            $('#redactBtn').click(function() {
                if (!$('#redactBtn').hasClass("disabled")){
                    var redactor = $('#redactBtn').data("redactor");
                    redactor.commitChanges();
                }
            });
            
            //overview button
            $('#overviewBtn').click(function(){
               if (!$('#overviewBtn').hasClass("disabled")){
                   var redactor = $('#redactBtn').data("redactor");
                   
                   //disable buttons
                   $('.imageButtons').addClass("disabled");
                   
                   $('.hasFocus').fadeOut(400, function() {
                    //remove whatever did have focus
                    $('.hasFocus').removeClass('hasFocus');
                    $('#overview').addClass('hasFocus');
                    $('#overview').fadeIn(400);
                });
               } 
            });

            //placeholder button
            $('#placeholderBtn').click(function() {
                if (!$('#placeholderBtn').hasClass("disabled")){
                    var pptImage = $('#imageOverview').data("pptImage");

                    //show old image
                    $('#placeholderOld').empty();
                    var oldImg = document.createElement('img');
                    $(oldImg).addClass("ppt-image placeholderImage");
                    $(oldImg).attr("src", pptImage.url);
                    $('#placeholderOld').append($(oldImg));
                    
                    $('.hasFocus').fadeOut(400, function() {
                        //ensure save button is present and undo button is absent
                        $('#placeholderUndo').hide();
                        $('#placeholderSave').show();
                                
                        //remove whatever did have focus
                        $('.hasFocus').removeClass('hasFocus');
                        $('#placeholderOverview').addClass('hasFocus');
                        $('#placeholderOverview').fadeIn(400);
                    });
                }
            });
            
            //placeholder save
            $('#placeholderSave').click(function() {                
                var pptImage = $('#imageOverview').data("pptImage");
                var newSrc = 'img/placeholder.jpg';
                               
                var placeholderChange = new Change("placeholder", pptImage, newSrc, "CC0");
                var redactor = $('#redactBtn').data("redactor");
                
                var oldChange = redactor.getImageChange(pptImage);
                
                if (oldChange !== false){                    
                    switch (oldChange.type) {
                        case "cc":                 
                            $('#' + pptImage.name + ' .changeIcon').removeClass("ccChange");
                        break;
                        case "placeholder":
                            $('#' + pptImage.name + ' .changeIcon').removeClass("placeholderchange");
                        break;
                        case "flickr":
                            $('#' + pptImage.name + ' .changeIcon').removeClass("flickrchange");
                        break;
                    }    
                    redactor.removeChange(oldChange);
                }
                
                redactor.addChange(placeholderChange);
                $('#redactBtn').data("redactor", redactor);

                updateOverview(redactor);
                
                $('#' + pptImage.name + ' .changeIcon').addClass("placeholderChange");
                
                $('#placeholderOverview').removeClass('hasFocus');
                $('#placeholderOverview').fadeOut('400', function(){                    
                    $('#overview').addClass('hasFocus');
                    $('#overview').fadeIn(400);
                });
            });
            
            //placeholder undo
            $('#placeholderUndo').click(function(){                
                var redactor = $('#redactBtn').data("redactor");
                var pptImage = $('#imageOverview').data("pptImage");
                var oldChange = redactor.getImageChange(pptImage);
                if (oldChange !== false){
                    redactor.removeChange(oldChange);
                }                
                $('#redactBtn').data("redactor", redactor);
                
                updateOverview(redactor);
                
                $('#' + pptImage.name + ' .changeIcon').removeClass("placeholderChange");
                
                $('#placeholderOverview').removeClass('hasFocus');
                $('#placeholderOverview').fadeOut('400', function(){                    
                    $('#overview').addClass('hasFocus');
                    $('#overview').fadeIn(400);
                });                      
            });
            
            //flickr button
            $('#flickrBtn').click(function() {
                if (!$('#flickrBtn').hasClass("disabled")){
                   $('.hasFocus').fadeOut(400, function() {
                    //remove whatever did have focus
                    $('.hasFocus').removeClass('hasFocus');
                    $('#flickrSearch').addClass('hasFocus');
                    $('#flickrSearch').fadeIn(400);
                });
                }
            });            

            //flickrBack button (from overview to search results)
            $('#flickrBack').click(function(){
                $('#flickrOverview').fadeOut(400, function() {
                    //remove whatever did have focus
                    $('#flickrOverview').removeClass('hasFocus');
                    $('#flickrSearch').addClass('hasFocus');
                    $('#flickrSearch').fadeIn(400);
                });                
            });
            
            //flickrSave button
            $('#flickrSave').click(function(){
                var pptImage = $('#imageOverview').data("pptImage");
                var flickrImage = $('#flickrOverview').data("flickrImage");
                               
                var flickrChange = new Change("flickr", pptImage, flickrImage.getMediumUrl(), flickrImage.textLicence);
                var redactor = $('#redactBtn').data("redactor");
                
                var oldChange = redactor.getImageChange(pptImage);
                if (oldChange !== false){
                    switch (oldChange.type) {
                        case "cc":                 
                            $('#' + pptImage.name + ' .changeIcon').removeClass("ccChange");
                        break;
                        case "placeholder":
                            $('#' + pptImage.name + ' .changeIcon').removeClass("placeholderchange");
                        break;
                        case "flickr":
                            $('#' + pptImage.name + ' .changeIcon').removeClass("flickrchange");
                        break;
                    } 
                    redactor.removeChange(oldChange);
                }
        
                redactor.addChange(flickrChange);
                $('#redactBtn').data("redactor", redactor);
                
                updateOverview(redactor);

                $('#' + pptImage.name + ' .changeIcon').addClass("flickrChange");

                $('#flickrOverview').removeClass('hasFocus');
                $('#flickrOverview').fadeOut('400', function(){                    
                    $('#overview').addClass('hasFocus');
                    $('#overview').fadeIn(400);
                });
            });
            
            //flickr undo
            $('#flickrUndo').click(function(){                
                var redactor = $('#redactBtn').data("redactor");
                var pptImage = $('#imageOverview').data("pptImage");
                var oldChange = redactor.getImageChange(pptImage);
                if (oldChange !== false){
                    redactor.removeChange(oldChange);
                }                
                $('#redactBtn').data("redactor", redactor);
                
                updateOverview(redactor);
                
                $('#' + pptImage.name + ' .changeIcon').removeClass("flickrChange");
                
                $('#flickrOverview').removeClass('hasFocus');
                $('#flickrOverview').fadeOut('400', function(){                    
                    $('#overview').addClass('hasFocus');
                    $('#overview').fadeIn(400);
                });                      
            });
            
            //cc button
            $('#ccBtn').click(function() {
                if (!$('#ccBtn').hasClass("disabled")){
                var pptImage = $('#imageOverview').data("pptImage");

                //show old image
                $('#ccOld').empty();
                var oldImg = document.createElement('img');
                $(oldImg).addClass("ppt-image");
                $(oldImg).attr("src", pptImage.url);
                $('#ccOld').append($(oldImg));
                
                //add the span helper for centering images
                var span = document.createElement('span');
                $(span).addClass("helper");
                $('#ccOld').append($(span)); 
                
                $('.hasFocus').fadeOut(400, function() {
                    //ensure save button is present and undo button is absent
                    $('#ccUndo').hide();
                    $('#ccSave').show();
                    
                    //remove whatever did have focus
                    $('.hasFocus').removeClass('hasFocus');
                    $('#ccOverview').addClass('hasFocus');
                    $('#ccOverview').fadeIn(400);
                });
                }
            });
            
            //cc save
            $('#ccSave').click(function() {                
                var pptImage = $('#imageOverview').data("pptImage");
                var newSrc = pptImage.name + pptImage.format;
                
                var selector = document.getElementById("ccSelector");
                var licence = selector.options[selector.selectedIndex].text;                
                
                var ccChange = new Change("cc", pptImage, newSrc, licence);
                var redactor = $('#redactBtn').data("redactor");
                
                var oldChange = redactor.getImageChange(pptImage);
                if (oldChange !== false){
                    switch (oldChange.type) {
                        case "cc":                 
                            $('#' + pptImage.name + ' .changeIcon').removeClass("ccChange");
                        break;
                        case "placeholder":
                            $('#' + pptImage.name + ' .changeIcon').removeClass("placeholderchange");
                        break;
                        case "flickr":
                            $('#' + pptImage.name + ' .changeIcon').removeClass("flickrchange");
                        break;
                    } 
                    redactor.removeChange(oldChange);
                }
                
                redactor.addChange(ccChange);
                $('#redactBtn').data("redactor", redactor);              
                
                updateOverview(redactor);    
                
                $('#' + pptImage.name + ' .changeIcon').addClass("ccChange");

                $('#ccOverview').removeClass('hasFocus');                
                $('#ccOverview').fadeOut('400', function(){                    
                    $('#overview').addClass('hasFocus');
                    $('#overview').fadeIn(400);
                });
            });
            
            //cc undo
            $('#ccUndo').click(function(){                
                var redactor = $('#redactBtn').data("redactor");
                var pptImage = $('#imageOverview').data("pptImage");
                var oldChange = redactor.getImageChange(pptImage);
                if (oldChange !== false){
                    redactor.removeChange(oldChange);
                }                
                $('#redactBtn').data("redactor", redactor);
                                
                updateOverview(redactor);
            
                $('#' + pptImage.name + ' .changeIcon').removeClass("ccChange");
            
                $('#ccOverview').removeClass('hasFocus');
                $('#ccOverview').fadeOut('400', function(){                    
                    $('#overview').addClass('hasFocus');
                    $('#overview').fadeIn(400);
                });                      
            });
            
            function updateOverview(redactor){
                //get initial numbers
                var pptViewer = new PowerPointViewer(redactor.ppt);
                var licenceNumbers = pptViewer.getNoLicencedImages();    
                var totalNull = licenceNumbers.none;
                var totalOther = licenceNumbers.other;
                var totalCC = licenceNumbers.cc;                
                
                var changeArray = redactor.changeArray;
                for (var i = 0; i < changeArray.length; i++){
                     var oldLicence = changeArray[i].pptImage.licence;
                     totalCC++;
                     if (oldLicence === "CC0" ||
                         oldLicence === "Attribution (CC BY)" ||
                         oldLicence === "NoDerivs (CC BY-ND)" ||
                         oldLicence === "NonCommercial, NoDerivs (CC BY-NC-ND)" ||
                         oldLicence === "NonCommercial (CC BY-NC)" ||
                         oldLicence === "NonCommercial, ShareAlike (CC BY-NC-SA)" ||
                         oldLicence === "ShareAlike (CC BY-SA)") {
                         totalCC--;
                     }else{
                         if (typeof oldLicence !== "undefined" && oldLicence !== "null" && oldLicence !== null){
                             totalOther--;
                         }else{
                            totalNull--;
                        }
                    }                        
                }
                
                var totalLicenced = totalOther + totalCC;
                $('#licencedImages').empty(); 
                $('#licencedImages').append(totalLicenced); 
        
                //overall licence
                var imageLicences = new Array();
                var images = redactor.ppt.pptImageArray;
                for (var j = 0; j < images.length; j++){
                    var image = images[j];
                    //console.log(image);
                    var imageChange = redactor.getImageChange(image);
                    //console.log(imageChange);
                    if (imageChange !== false){
                        imageLicences.push(imageChange.licence);
                    }else{
                        imageLicences.push(image.licence);
                    }
                }              
                
                var lowestLicence = pptViewer.getLowestLicence(totalNull, totalOther, imageLicences);                
                $('#overallLicence').empty();
                $('#overallLicence').append(lowestLicence); //need to work this out somehow
                
                var totalImages = redactor.ppt.pptImageArray.length;
                var progressCC = (totalCC / totalImages) * 100;
                var progressOther = (totalOther / totalImages) * 100;
                var progressNull = (totalNull / totalImages) * 100;
        
                $('#progressCC').attr("style", "width:" + progressCC + "%");
                $('#progressOther').attr("style", "width:" + progressOther + "%");
                $('#progressNull').attr("style", "width:" + progressNull + "%");                    
            }


            $(document).ready(function() {
                $('#mycarousel').jcarousel({
                    size: 0
                });
            });

            $(function() {
                // Bootstrap Arrows
                $('.arrow, [class^=arrow-]').bootstrapArrows();
            });

            $(window).on('beforeunload', function() {
                var redactor = $('#redactBtn').data("redactor");
                var images = redactor.ppt.pptImageArray;
                for (var i = 0; i < images.length; i++){
                    var image = images[i];
                    if (image.format === ".jpeg") {
                       var filename = image.name + image.format;
                       var phpUrl = "php/imagedeleter.php";
                       $.get(phpUrl, { fname: filename } );         
                    }
                }
            });
            
           
        </script>

    </body>
</html>


